<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Панель управления - Fitness Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/fragments/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/app/dashboard.css}">
</head>
<body>
    <!-- HEADER SECTION -->
    <header class="header">
    <div class="app-container">
        <div th:replace="~{fragments/sidebar :: sidebar('dashboard')}"></div>
        
        <div class="main-content">
            <div class="top-bar">
                <h1>Панель управления</h1>
            </div>
            
                <!-- MAIN CONTENT SECTION -->
                <main class="content">
                <div class="dashboard-grid">
                        <!-- Карточка общей статистики -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Общая статистика</h3>
                        </div>
                        <div class="card-body">
                            <div class="stats">
                                <div class="stat-item">
                                    <div class="stat-value" th:text="${workoutsCount}">12</div>
                                    <div class="stat-label">Тренировок</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" th:text="${goalsCount}">3</div>
                                    <div class="stat-label">Цели</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" th:text="${totalHours}">8.5</div>
                                    <div class="stat-label">Время</div>
                                </div>
                            </div>
                            <a href="/app/stats" class="btn btn-outline">Подробнее</a>
                        </div>
                    </div>
                    
                        <!-- Карточка последних тренировок -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Последние тренировки</h3>
                        </div>
                        <div class="card-body">
                            <div th:if="${recentWorkouts.isEmpty()}" class="no-items-message">
                                <p>У вас пока нет тренировок</p>
                            </div>
                            <div th:each="workout : ${recentWorkouts}" style="margin-bottom: 1rem;">
                                <div style="margin-bottom: 0.5rem;" th:text="${workout.name + ' - ' + workout.duration + ' мин'}">Бег - 5.2 км</div>
                                <div style="font-size: 0.875rem; color: #6c757d;" 
                                     th:with="days=${T(java.time.temporal.ChronoUnit).DAYS.between(workout.completedAt, T(java.time.LocalDateTime).now())}">
                                    <span th:if="${days == 0}">Сегодня, </span>
                                    <span th:if="${days == 1}">Вчера, </span>
                                    <span th:if="${days > 1}" th:text="${days + ' дня назад, '}">2 дня назад, </span>
                                    <span th:text="${#temporals.format(workout.completedAt, 'HH:mm')}">18:30</span>
                                </div>
                            </div>
                            <a th:if="${!recentWorkouts.isEmpty()}" href="/app/workouts" class="btn btn-outline">Все тренировки</a>
                            <a th:if="${recentWorkouts.isEmpty()}" href="/app/workouts/create" class="btn">Добавить тренировку</a>
                        </div>
                    </div>
                    
                        <!-- Карточка прогресса по целям -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Прогресс по целям</h3>
                        </div>
                        <div class="card-body">
                            <div th:if="${activeGoals == null || activeGoals.isEmpty()}" class="no-items-message">
                                <p>У вас нет активных целей</p>
                                <a href="/app/goals/create" class="btn">Добавить цель</a>
                            </div>
                            <div th:if="${activeGoals != null && !activeGoals.isEmpty()}">
                                <div th:each="goal : ${activeGoals}" class="progress-container" 
                                     th:if="${goal.currentValue != null && goal.targetValue != null && goal.targetValue > 0}">
                                    <div class="goal-details">
                                        <div class="goal-name" th:text="${goal.name}">Бег 50 км в месяц</div>
                                        <div class="goal-progress">
                                            <span th:if="${goal.unit != null}" 
                                                  th:text="${goal.currentValue + ' ' + goal.unit + ' из ' + goal.targetValue + ' ' + goal.unit}">
                                                34 км из 50 км
                                            </span>
                                            <span th:unless="${goal.unit != null}" 
                                                  th:text="${goal.currentValue + ' из ' + goal.targetValue}">
                                                34 из 50
                                            </span>
                                            <span th:with="progress=${goal.currentValue * 100 / goal.targetValue}"
                                                  th:text="${#numbers.formatDecimal(progress, 1, 0) + '%'}">68%</span>
                                        </div>
                                </div>
                                <div class="progress-bar">
                                        <div class="progress-bar-inner" 
                                             th:with="progress=${goal.currentValue * 100 / goal.targetValue}"
                                             th:style="'width: ' + ${progress <= 100 ? progress : 100} + '%'"></div>
                                    </div>
                                </div>
                                <a href="/app/goals" class="btn btn-outline">Все цели</a>
                            </div>
                        </div>
                    </div>
                    
                        <!-- Карточка быстрых действий -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Быстрые действия</h3>
                        </div>
                        <div class="card-body">
                            <a href="/app/workouts/create" class="btn" style="display: block; margin-bottom: 0.75rem; text-align: center;">Добавить тренировку</a>
                            <a href="/app/goals/create" class="btn" style="display: block; text-align: center;">Добавить цель</a>
                        </div>
                    </div>
                </div>
                </main>
                <!-- END MAIN CONTENT SECTION -->
            </div>
        </div>
    </header>
    <!-- END HEADER SECTION -->
    
    <script th:src="@{/js/fragments/sidebar.js}"></script>
    <script th:src="@{/js/app/dashboard.js}"></script>
</body>
</html> 